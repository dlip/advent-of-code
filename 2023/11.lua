local input = [[
.....................................................................................#......#...............................................
..#.....#.................................................................#........................#........................................
...............................#...............................................................................#.....#......................
.................................................#.............#...............................#...................................#........
..............#......#.................#...............#............#.............#..........................................#..............
.........................................................................................#.................#...............................#
.#..........................................................................................................................................
..........................#......#............................................#......#.................................#....................
.................................................................................................#..........................................
.........................................#..........#..........#............................................................#...............
......#.....#......#..........................#........................#....................................................................
....................................#.........................................................................#..........................#..
..................................................................................#.........................................................
...................................................................................................................#........................
.................................................................#........................................#.................................
.............................#..............................#..........................#.......#............................................
..........................................#.....#.............................#.............................................................
#..................#..................................................................................................................#.....
....................................#...................#..........................#...........................#..............#.............
........#................#...................#.............................................................................................#
...............................#....................#...........................................#...........................................
.......................................#..............................................#.....................................................
........................................................................#........#...........................#..............................
..................................#........#...................#........................................#.........#.................#.......
#................#........................................................................................................#.................
.........#.......................................#...............................................#.............................#........#...
...............................................................................................................#............................
.........................................................................................#..................................................
...........................................................#..................................#..........#...........................#......
......#.........................#..........................................................................................#................
....................#.....................#.......#...............................#.................................#.......................
..........................#..............................................#..................................................................
..........#..........................#.......................#...................................#..............#..............#...........#
......................................................#.....................................................................................
............................................................................................................................................
#...............................................#................#............................#.............................................
..................#......................#............................#................................#................................#...
............................................................................................................................................
....................................................#....................................#.............................#....................
..............#...................#................................#..........#..............................#.............................#
............................#...............................................................................................#...............
....#.................#.....................................#..........#............................................................#.......
......................................................#.....................................................................................
...........#..............................#.................................................#..........#.................#..................
.................................#..............#................#..........#.......#.......................................................
...................................................................................................................#..............#.........
#...........................................................................................................#...............................
........#.......#............................................................................................................#..............
............................#.....................#..........#......................................#.....................................#.
.....................................#.................................................#........................#...........................
.........................................................................................................................#...........#......
.......................#.............................#........................#.............................................................
..............#...............................#.................#..................#........#...............................................
...#......................................................................#.................................#..............................#
...................#..................#.............................................................................#........#..............
............................................................................................................................................
.........................#.........................#........................................................................................
......#......#.............................................#.............................#............#.....................................
.................................#......................................#...................................................................
.........................................#........................#..............................#.................#..............#.........
............................................................................................................................................
......................................................#.................................................#..............#..................#.
......................#......#...............#...................................#............................#.............................
....#...........#.................#............................................................#...............................#............
..........................................................................#..........................#......................................
..........................................#................................................#...............................#............#...
................................................................................................................#...........................
..........#....................................#...................................................................................#........
................................#....................#..............................................................#.......................
......#.......................................................#...............................#.............................................
#.......................#.....................................................................................................#.............
.................#...................#...........................................#..........................#...............................
.....................................................................#....................#.................................................
..............................#.................#.......#.........................................#.........................................
..#........................................................................#....................................#.........#.................
...........#............................#..........................................#.............................................#..........
......#.............................................................................................................#.....................#.
........................................................................................................#...................................
..............#...................#.........#...............................................................................................
........................................................#.............#..........#.....#..........#............................#............
.........#......................................................#...........................#...............................................
.........................................#...................................#.................................#............................
............................................................................................................................................
................#...................................................................#.................#..................#..................
.................................#..........................#.............#....................#................................#..........#
...#........................#.........................................................................................................#.....
.................................................#......................................#.....................#......#......................
...........................................#.........................#........#.............................................................
........#......#...................................................................................................................#.....#..
.#..................#..................................#.........#..........................................................................
..................................#.....#.................................#.................................................................
...................................................#.................................#......................................................
............................................................#...............................................................................
.............................................#......................#..........#............#.........................#......#..............
................................#...................................................................#.......................................
.....................................................#..................#......................................#............................
...#......................#.....................................................................................................#...........
...........#...........................................................................#..............................................#.....
................#..................................................#..............................................#.........................
.......................#......................................................................#.............................................
................................#........#.........#.....................#.....#......................#.....................................
.#..........................................................................................................................................
........................................................#................................#...................#..................#...........
.....................................#........#.................................................#.......................................#...
.........#...........#......................................................................................................................
....................................................#.............................................................#.................#.......
.............#............#........................................#.............#.....................#...................#...............#
..................#....................#.................................#.............#....................................................
................................................#...........................................................................................
.......................#...............................................................................................#....................
....#..........................................................#.....#..............#...........................................#...........
...............................................................................................#..................#.......................#.
.........#...................#............................................#.................................................................
.............................................................................................................#..............#......#........
...........................................................................................#................................................
.#...........................................................#..............................................................................
..............#..............................#........................................#.............#.......................................
....................................#..............#..............#.........#.............................#.............#.............#.....
....................#............................................................................................#..........................
.........................................................................................#..................................................
...........#............................#................#....................................................................#.............
.....#......................................................................................................#...............................
..................................#................................................#........#.............................................#.
.#................#......#...........................................................................#......................................
..............................................#.......................#................#............................................#.......
.........#............................#........................#..........................................#.....#......#....................
..............................................................................................#.............................................
........................................................................................................................................#...
..........................#........................#...............#................................#............................#..........
..#........................................#............#............................................................#......................
...............................#.....#........................................#.......#......................................#..............
.......................................................................................................#....................................
.....................................................#..............................................................................#.......
........#......................................#...........................#.............................................#.................#
...................#.....#......................................#.............................#.............................................
............#.........................#......................................................................#.......#.................#....
..............................#...................................................#.........................................................
............................................#.........................................................#.....................................
.......#..........................#................#.....#.............#....................................................................
..................#.........................................................#.............#.......................................#.........
]]

local sample_input = [[
...#......
.......#..
#.........
..........
......#...
.#........
.........#
..........
.......#..
#...#.....
]]

local function part_one(txt)
  local data = {}
  local galaxies = {}

  for line in txt:gmatch("[^\r\n]+") do
    local chars = {}
    local all_space = true
    for char in line:gmatch(".") do
      if char ~= "." then
        all_space = false
      end
      table.insert(chars, char)
    end
    table.insert(data, chars)
    if all_space then
      table.insert(data, chars)
    end
  end

  local width = #data[1]
  local x = 1
  while true do
    local all_space = true
    for y, _ in ipairs(data) do
      local char = data[y][x]
      if char ~= "." then
        all_space = false
        break
      end
    end
    if all_space then
      for y, _ in ipairs(data) do
        local row = {}
        for x2, d in ipairs(data[y]) do
          table.insert(row, d)
          if x2 == x then
            table.insert(row, d)
          end
        end
        data[y] = row
      end
      width = width + 1
      x = x + 1
    end
    x = x + 1
    if x == width then
      break
    end
  end

  for y = 1, #data do
    for x = 1, #data[y] do
      local char = data[y][x]
      if char == "#" then
        table.insert(galaxies, { y, x })
      end
    end
  end

  local sum = 0
  for x = 1, #galaxies - 1 do
    local a = galaxies[x]
    for y = x + 1, #galaxies do
      local b = galaxies[y]
      local dist = math.abs(b[1] - a[1]) + math.abs(b[2] - a[2])
      print(x, y, dist)
      sum = sum + dist
    end
  end
  print(sum)
end

-- part_one(sample_input)

local function part_two(txt)
  local data = {}
  local galaxies = {}
  local expand = 1000000
  expand = expand - 1

  local expand_y = {}
  local expand_x = {}

  local y = 0
  for line in txt:gmatch("[^\r\n]+") do
    y = y + 1
    local chars = {}
    local x = 0
    local all_space = true
    for char in line:gmatch(".") do
      x = x + 1
      if char == "#" then
        table.insert(galaxies, { y, x })
        all_space = false
      end
      table.insert(chars, char)
    end
    if all_space then
      expand_y[y] = true
    end
    table.insert(data, chars)
  end

  for x = 1, #data[1] do
    local all_space = true
    for y, _ in ipairs(data) do
      local char = data[y][x]
      if char ~= "." then
        all_space = false
        break
      end
    end
    if all_space then
      expand_x[x] = true
    end
  end

  local sum = 0
  for x = 1, #galaxies - 1 do
    local a = galaxies[x]
    for y = x + 1, #galaxies do
      local b = galaxies[y]
      local dist = math.abs(b[1] - a[1]) + math.abs(b[2] - a[2])
      for y = math.min(a[1], b[1]), math.max(a[1], b[1]) do
        if expand_y[y] then
          dist = dist + expand
        end
      end
      for x = math.min(a[2], b[2]), math.max(a[2], b[2]) do
        if expand_x[x] then
          dist = dist + expand
        end
      end
      sum = sum + dist
    end
  end
  print(sum)
end

part_two(input)
